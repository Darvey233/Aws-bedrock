{"filter":false,"title":"bedrock_embedding.py","tooltip":"/workshop/labs/embedding/bedrock_embedding.py","undoManager":{"mark":10,"position":10,"stack":[[{"start":{"row":0,"column":0},"end":{"row":4,"column":0},"action":"insert","lines":["from langchain_community.embeddings import BedrockEmbeddings","from numpy import dot","from numpy.linalg import norm","",""],"id":1}],[{"start":{"row":4,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["#create an Amazon Titan Embeddings client","belc = BedrockEmbeddings()","",""],"id":2}],[{"start":{"row":7,"column":0},"end":{"row":17,"column":0},"action":"insert","lines":["class EmbedItem:","    def __init__(self, text):","        self.text = text","        self.embedding = belc.embed_query(text)","","class ComparisonResult:","    def __init__(self, text, similarity):","        self.text = text","        self.similarity = similarity","",""],"id":3}],[{"start":{"row":17,"column":0},"end":{"row":20,"column":0},"action":"insert","lines":["def calculate_similarity(a, b): #See Cosine Similarity: https://en.wikipedia.org/wiki/Cosine_similarity","    return dot(a, b) / (norm(a) * norm(b))","",""],"id":4}],[{"start":{"row":20,"column":0},"end":{"row":29,"column":0},"action":"insert","lines":["#Build the list of embeddings to compare","items = []","","with open(\"items.txt\", \"r\") as f:","    text_items = f.read().splitlines()","","for text in text_items:","    items.append(EmbedItem(text))","",""],"id":5}],[{"start":{"row":18,"column":42},"end":{"row":19,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":15,"column":36},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":16,"column":0},"end":{"row":16,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":5,"column":26},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":8}],[{"start":{"row":32,"column":0},"end":{"row":33,"column":0},"action":"insert","lines":["",""],"id":9}],[{"start":{"row":33,"column":0},"end":{"row":51,"column":0},"action":"insert","lines":["for e1 in items:","    print(f\"Closest matches for '{e1.text}'\")","    print (\"----------------\")","    cosine_comparisons = []","    ","    for e2 in items:","        similarity_score = calculate_similarity(e1.embedding, e2.embedding)","        ","        cosine_comparisons.append(ComparisonResult(e2.text, similarity_score)) #save the comparisons to a list","        ","    cosine_comparisons.sort(key=lambda x: x.similarity, reverse=True) # list the closest matches first","    ","    for c in cosine_comparisons:","        print(\"%.6f\" % c.similarity, \"\\t\", c.text)","    ","    print()","","",""],"id":10}],[{"start":{"row":50,"column":0},"end":{"row":51,"column":0},"action":"remove","lines":["",""],"id":12},{"start":{"row":49,"column":0},"end":{"row":50,"column":0},"action":"remove","lines":["",""]},{"start":{"row":48,"column":11},"end":{"row":49,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":48,"column":11},"end":{"row":49,"column":0},"action":"insert","lines":["cd ~/environment/workshop/labs/embedding",""],"id":13}]]},"ace":{"folds":[],"scrolltop":289.1999999999999,"scrollleft":0,"selection":{"start":{"row":48,"column":11},"end":{"row":48,"column":11},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1716764811304,"hash":"311aaceddbfd005d2b57fb459adc5f577c5a6aea"}