{"filter":false,"title":"intro_streaming.py","tooltip":"/workshop/labs/intro_streaming/intro_streaming.py","undoManager":{"mark":7,"position":7,"stack":[[{"start":{"row":0,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["import json","import boto3","",""],"id":1}],[{"start":{"row":3,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["session = boto3.Session()","","bedrock = session.client(service_name='bedrock-runtime') #creates a Bedrock client","",""],"id":2}],[{"start":{"row":7,"column":0},"end":{"row":10,"column":0},"action":"insert","lines":["def chunk_handler(chunk):","    print(chunk, end='')","",""],"id":3}],[{"start":{"row":10,"column":0},"end":{"row":35,"column":0},"action":"insert","lines":["def get_streaming_response(prompt, streaming_callback):","","    bedrock_model_id = \"anthropic.claude-3-sonnet-20240229-v1:0\" #set the foundation model","    ","    body = json.dumps({","        \"anthropic_version\": \"bedrock-2023-05-31\",","        \"max_tokens\": 8000,","        \"temperature\": 0,","        \"messages\": [","            {","                \"role\": \"user\",","                \"content\": [{ \"type\": \"text\", \"text\": prompt } ]","            }","        ],","    })","    ","    response = bedrock.invoke_model_with_response_stream(modelId=bedrock_model_id, body=body) #invoke the streaming method","    ","    for event in response.get('body'):","        chunk = json.loads(event['chunk']['bytes'])","","        if chunk['type'] == 'content_block_delta':","            if chunk['delta']['type'] == 'text_delta':","                streaming_callback(chunk['delta']['text'])","",""],"id":4}],[{"start":{"row":35,"column":0},"end":{"row":39,"column":0},"action":"insert","lines":["prompt = \"Tell me a story about two puppies and two kittens who became best friends:\"","                ","get_streaming_response(prompt, chunk_handler)","",""],"id":5}],[{"start":{"row":33,"column":58},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":34,"column":0},"end":{"row":34,"column":16},"action":"insert","lines":["                "]}],[{"start":{"row":8,"column":24},"end":{"row":9,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":9,"column":0},"end":{"row":9,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":5,"column":82},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":8}]]},"ace":{"folds":[],"scrolltop":309.6,"scrollleft":0,"selection":{"start":{"row":29,"column":4},"end":{"row":29,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1716764336298,"hash":"608290cf9a5409e10e207e573841b28c1bf01384"}