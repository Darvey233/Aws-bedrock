{"filter":false,"title":"summarization_lib.py","tooltip":"/workshop/labs/summarization/summarization_lib.py","undoManager":{"mark":7,"position":7,"stack":[[{"start":{"row":0,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["from langchain.prompts import PromptTemplate","from langchain_community.llms import Bedrock","from langchain.chains.summarize import load_summarize_chain","from langchain_text_splitters import RecursiveCharacterTextSplitter","from langchain_community.document_loaders import PyPDFLoader","","",""],"id":1}],[{"start":{"row":7,"column":0},"end":{"row":25,"column":0},"action":"insert","lines":["def get_llm():","    ","    model_kwargs = { #AI21","        \"maxTokens\": 8000, ","        \"temperature\": 0, ","        \"topP\": 0.5, ","        \"stopSequences\": [], ","        \"countPenalty\": {\"scale\": 0 }, ","        \"presencePenalty\": {\"scale\": 0 }, ","        \"frequencyPenalty\": {\"scale\": 0 } ","    }","    ","    llm = Bedrock(","        model_id=\"ai21.j2-ultra-v1\", #set the foundation model","        model_kwargs=model_kwargs) #configure the inference parameters","    ","    return llm","",""],"id":2}],[{"start":{"row":25,"column":0},"end":{"row":38,"column":0},"action":"insert","lines":["pdf_path = \"2022-Shareholder-Letter.pdf\"","","def get_docs():","    ","    loader = PyPDFLoader(file_path=pdf_path)","    documents = loader.load()","    text_splitter = RecursiveCharacterTextSplitter(","        separators=[\"\\n\\n\", \"\\n\", \".\", \" \"], chunk_size=4000, chunk_overlap=100 ","    )","    docs = text_splitter.split_documents(documents=documents)","    ","    return docs","",""],"id":3}],[{"start":{"row":23,"column":14},"end":{"row":24,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":24,"column":0},"end":{"row":24,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":39,"column":0},"end":{"row":58,"column":0},"action":"insert","lines":["def get_summary(return_intermediate_steps=False):","    ","    map_prompt_template = \"{text}\\n\\nWrite a few sentences summarizing the above:\"","    map_prompt = PromptTemplate(template=map_prompt_template, input_variables=[\"text\"])","    ","    combine_prompt_template = \"{text}\\n\\nWrite a detailed analysis of the above:\"","    combine_prompt = PromptTemplate(template=combine_prompt_template, input_variables=[\"text\"])","    ","    ","    llm = get_llm()","    docs = get_docs()","    ","    chain = load_summarize_chain(llm, chain_type=\"map_reduce\", map_prompt=map_prompt, combine_prompt=combine_prompt, return_intermediate_steps=return_intermediate_steps)","    ","    if return_intermediate_steps:","        return chain.invoke({\"input_documents\": docs}, return_only_outputs=True)","    else:","        return chain.invoke(docs, return_only_outputs=True)","",""],"id":5}],[{"start":{"row":38,"column":0},"end":{"row":39,"column":0},"action":"insert","lines":["",""],"id":6}],[{"start":{"row":59,"column":0},"end":{"row":60,"column":0},"action":"insert","lines":["",""],"id":7}],[{"start":{"row":59,"column":0},"end":{"row":60,"column":0},"action":"remove","lines":["",""],"id":8},{"start":{"row":58,"column":0},"end":{"row":59,"column":0},"action":"remove","lines":["",""]},{"start":{"row":57,"column":59},"end":{"row":58,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":57,"column":59},"end":{"row":57,"column":59},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1716767728632,"hash":"cb318fd9b30d7c23a2c81c248565e6df6ce6a466"}